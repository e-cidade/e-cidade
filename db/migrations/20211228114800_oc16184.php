<?php

use ECidade\Suporte\Phinx\PostgresMigration;

class Oc16184 extends PostgresMigration
{
    public function up()
    {
       $insertTempTable = "select fc_startsession();
                        BEGIN;

                        CREATE TABLE IF NOT EXISTS public.pcasp_orcam(estrut_orc varchar, estrut_pcasp varchar, grupo integer );

                        INSERT INTO pcasp_orcam VALUES
                        ('411120111010000', '411210100', 16), ('411120111020000', '411210100', 16), ('411120111030000', '411210100', 16), ('411125001010000', '411210200', 16), ('411125001020000', '411210200', 16), ('411125001030000', '411210200', 16),
                        ('411125002010000', '442410500', 16), ('411125002020000', '442410500', 16), ('411125002030000', '442410500', 16), ('411125003010000', '112510105', 16), ('411125003020000', '112510105', 16), ('411125003030000', '112510105', 16),
                        ('411125004010000', '442411600', 16), ('411125004020000', '442411600', 16), ('411125004030000', '442411600', 16), ('411125301010000', '411210400', 16), ('411125301020000', '411210400', 16), ('411125301030000', '411210400', 16),
                        ('411125302010000', '442410600', 16), ('411125302020000', '442410600', 16), ('411125302030000', '442410600', 16), ('411125303010000', '112510106', 16), ('411125303020000', '112510106', 16), ('411125303030000', '112510106', 16),
                        ('411125304010000', '442411600', 16), ('411125304020000', '442411600', 16), ('411125304030000', '442411600', 16), ('411130311010000', '411210301', 16), ('411130311020000', '411210301', 16), ('411130311030000', '411210301', 16),
                        ('411130341010000', '411210302', 16), ('411130341020000', '411210302', 16), ('411130341030000', '411210302', 16), ('411145111010000', '411310200', 16), ('411145111020000', '411310200', 16), ('411145111030000', '411310200', 16),
                        ('411145112010000', '442410700', 16), ('411145112020000', '442410700', 16), ('411145112030000', '442410700', 16), ('411145113010000', '112510107', 16), ('411145113020000', '112510107', 16), ('411145113030000', '112510107', 16),
                        ('411145114010000', '442411600', 16), ('411145114020000', '442411600', 16), ('411145114030000', '442411600', 16), ('411145121010000', '411310200', 16), ('411145121020000', '411310200', 16), ('411145121030000', '411310200', 16),
                        ('411145201010000', '411319900', 16), ('411145201020000', '411319900', 16), ('411210101010000', '412110300', 16), ('411210101020000', '412110300', 16), ('411210102010000', '442410900', 16), ('411210103010000', '', 16),
                        ('411210104010000', '442411600', 16), ('411210211010000', '412110300', 16), ('411210221010000', '412110300', 16), ('411210301010000', '412111101', 16), ('411210301020000', '412111101', 16), ('411210302010000', '442410900', 16),
                        ('411210302020000', '442410900', 16), ('411210303010000', '', 16), ('411210303020000', '', 16), ('411210304010000', '442411600', 16), ('411210304020000', '442411600', 16), ('411210401010000', '412111400', 16),
                        ('411210401020000', '412111400', 16), ('411210402010000', '442410900', 16), ('411210402020000', '442410900', 16), ('411210403010000', '', 16), ('411210403020000', '', 16), ('411210404010000', '442411600', 16),
                        ('411210404020000', '442411600', 16), ('411210501010000', '412111102', 16), ('411210501020000', '412111102', 16), ('411210502010000', '442410900', 16), ('411210502020000', '442410900', 16), ('411210503010000', '', 16),
                        ('411210503020000', '', 16), ('411210504010000', '442411600', 16), ('411210504020000', '442411600', 16), ('411215001010000', '412111101', 16), ('411215001020000', '412111101', 16), ('411215002010000', '442410900', 16),
                        ('411215002020000', '442410900', 16), ('411215003010000', '', 16), ('411215003020000', '', 16), ('411215004010000', '442411600', 16), ('411215004020000', '442411600', 16), ('411215101010000', '412111502', 16),
                        ('411215101020000', '412111502', 16), ('411215102010000', '442410900', 16), ('411215102020000', '442410900', 16), ('411215103010000', '', 16), ('411215103020000', '', 16), ('411215104010000', '442411600', 16),
                        ('411215104020000', '442411600', 16), ('411220101010000', '412111501', 16), ('411220101020000', '412111501', 16), ('411220102010000', '442411000', 16), ('411220103010000', '', 16), ('411220104010000', '442411600', 16),
                        ('411225201010000', '412219900', 16), ('411225201020000', '412219900', 16), ('411225202010000', '442411000', 16), ('411225202020000', '442411000', 16), ('411225203010000', '', 16), ('411225203020000', '', 16),
                        ('411225204010000', '442411600', 16), ('411225204020000', '442411600', 16), ('411315001010000', '413110100', 16), ('411315001020000', '413110100', 16), ('411315002010000', '442411300', 16), ('411315002020000', '442411300', 16),
                        ('411315003010000', '112510301', 16), ('411315003020000', '112510301', 16), ('411315004010000', '442411600', 16), ('411315004020000', '442411600', 16), ('411315101010000', '413210100', 16), ('411315101020000', '413210100', 16),
                        ('411315201010000', '413310100', 16), ('411315201020000', '413310100', 16), ('411319901020000', '413910100', 16), ('412150111010000', '421110201', 16), ('412150111020000', '421110201', 16), ('412150111030000', '421110201', 16),
                        ('412150121010000', '421110202', 16), ('412150121020000', '421110202', 16), ('412150121030000', '421110202', 16), ('412150131010000', '421110203', 16), ('412150131020000', '421110203', 16), ('412150141010000', '421110204', 16),
                        ('412150141020000', '421110204', 16), ('412150141030000', '421110204', 16), ('412150151010000', '421110205', 16), ('412150151020000', '421110205', 16), ('412150161010000', '421110206', 16), ('412150161020000', '421110206', 16),
                        ('412150161030000', '421110206', 16), ('412150211010000', '421110201', 16), ('412150211020000', '421110201', 16), ('412150211030000', '421110201', 16), ('412150221010000', '421110201', 16), ('412150221020000', '421110201', 16),
                        ('412150221030000', '421110201', 16), ('412155011010000', '421110202', 16), ('412155011020000', '421110202', 16), ('412155011030000', '421110202', 16), ('412155021010000', '421110203', 16), ('412155021020000', '421110203', 16),
                        ('412155021030000', '421110203', 16), ('412155031010000', '421110204', 16), ('412155031020000', '421110204', 16), ('412155031030000', '421110204', 16), ('412155041010000', '421110206', 16), ('412155041020000', '421110206', 16),
                        ('412155041030000', '421110206', 16), ('412155111010000', '421110201', 16), ('412155111020000', '421110201', 16), ('412155111030000', '421110201', 16), ('412155121010000', '421110202', 16), ('412155121020000', '421110202', 16),
                        ('412155121030000', '421110202', 16), ('412155131010000', '421110203', 16), ('412155131020000', '421110203', 16), ('412155131030000', '421110203', 16), ('412160311010000', '421910000', 16), ('412160321010000', '421910000', 16),
                        ('412169911010000', '421910000', 16), ('412169921010000', '421910000', 16), ('412199911010000', '421910000', 16), ('412199921010000', '421910000', 16), ('412415001010000', '423110100', 16), ('412415001020000', '423110100', 16),
                        ('413110111010000', '433110200', 16), ('413110121010000', '433110200', 16), ('413110201010000', '433112800', 16), ('413119901010000', '433119900', 16), ('413210101010000', '445110000', 16), ('413210101080000', '445110000', 16),
                        ('413210101101000', '445110000', 16), ('413210101102000', '445110000', 16), ('413210101108000', '445110000', 16), ('413210101113000', '445110000', 16), ('413210101117000', '445110000', 16), ('413210101119000', '445110000', 16),
                        ('413210101124000', '445110000', 16), ('413210101142000', '445110000', 16), ('413210101143000', '445110000', 16), ('413210101154000', '445110000', 16), ('413210101157000', '445110000', 16), ('413210101158000', '445110000', 16),
                        ('413210101169000', '445110000', 16), ('413210101188000', '445110000', 16), ('413210101191000', '445110000', 16), ('413210101192000', '445110000', 16), ('413210101193000', '445110000', 16), ('413210201010000', '445110000', 16),
                        ('413210301010000', '445110000', 16), ('413210401010000', '445210000', 16), ('413210401020000', '445210000', 16), ('413210401030000', '445210000', 16), ('413210501010000', '445210000', 16), ('413220101010000', '492210000', 16),
                        ('413230101010000', '492110000', 16), ('413299901010000', '449110000', 16), ('413299901020100', '449110000', 16), ('413299901030100', '449110000', 16), ('413299901040100', '449110000', 16), ('413310101010000', '433113000', 16),
                        ('413310401010000', '433113000', 16), ('413320111010000', '433113000', 16), ('413399901010000', '433119900', 16), ('413499901010000', '442910000', 16), ('413610111010000', '433119900', 16), ('413999901010000', '433110200', 16),
                        ('414110101010000', '431111199', 16), ('415110101010000', '432110000', 16), ('416110101010000', '433113700', 16), ('416110101020000', '433113700', 16), ('416110102010000', '442910000', 16), ('416110102020000', '442910000', 16),
                        ('416110103010000', '112619900', 16), ('416110103020000', '112619900', 16), ('416110104010000', '442910000', 16), ('416110104020000', '442910000', 16), ('416110201010000', '433113700', 16), ('416110301010000', '433111600', 16),
                        ('416110401010000', '433110800', 16), ('416210201010000', '433113000', 16), ('416210301010000', '433113100', 16), ('416315001010000', '433113300', 16), ('416315101010000', '433113300', 16), ('416315201010000', '433113300', 16),
                        ('416315301010000', '433113300', 16), ('416319901010000', '433113300', 16), ('416320101010000', '433113300', 16), ('416410101010000', '433115900', 16), ('416999901010000', '433119800', 16), ('416999902010000', '442910000', 16),
                        ('416999903010000', '112619900', 16), ('416999904010000', '442910000', 16), ('417115111010000', '452130200', 16), ('417115111020000', '452130200', 16), ('417115111030000', '452130200', 16), ('417115121010000', '452130200', 16),
                        ('417115121020000', '452130200', 16), ('417115131010000', '452130200', 16), ('417115131020000', '452130200', 16), ('417115201010000', '452130300', 16), ('417115201020000', '452130300', 16), ('417115201030000', '452130300', 16),
                        ('417115501010000', '452130500', 16), ('417115501020000', '452130500', 16), ('417119801010000', '452139900', 16), ('417119801020000', '452139900', 16), ('417125001010000', '452130600', 16), ('417125101010000', '452130600', 16),
                        ('417125101020000', '452130600', 16), ('417125211010000', '452130600', 16), ('417125211030000', '452130600', 16), ('417125221010000', '433112900', 16), ('417125221030000', '433112900', 16), ('417125231010000', '433112900', 16),
                        ('417125231030000', '433112900', 16), ('417125241010000', '433112900', 16), ('417125241030000', '433112900', 16), ('417129901010000', '433112900', 16), ('417135011010000', '452130700', 16), ('417135021010000', '452130700', 16),
                        ('417135031010000', '452130700', 16), ('417135041010000', '452130700', 16), ('417135051010000', '452130700', 16), ('417135091010000', '452130700', 16), ('417135111010000', '452130700', 16), ('417135121010000', '452130700', 16),
                        ('417135131010000', '452130700', 16), ('417135141010000', '452130700', 16), ('417135151010000', '452130700', 16), ('417135191010000', '452130700', 16), ('417145001010000', '452130900', 16), ('417145101010000', '452130900', 16),
                        ('417145201010000', '452130900', 16), ('417145301010000', '452130900', 16), ('417145411010000', '452130900', 16), ('417145421010000', '452130900', 16), ('417145501010000', '452130900', 16), ('417145601010000', '452130900', 16),
                        ('417145701010000', '452130900', 16), ('417145801010000', '452130900', 16), ('417145901010000', '452130900', 16), ('417149901010000', '452130900', 16), ('417155001010000', '452230000', 16), ('417155001020000', '452230000', 16),
                        ('417165001010000', '452130800', 16), ('417175001010000', '452339900', 16), ('417175101010000', '452339900', 16), ('417175201010000', '452339900', 16), ('417175301010000', '452339900', 16), ('417175401010000', '452339900', 16),
                        ('417179901010000', '452339900', 16), ('417195101010000', '452131000', 16), ('417195101020000', '452131000', 16), ('417195101030000', '452131000', 16), ('417195201010000', '452339900', 16), ('417195601010000', '452339900', 16),
                        ('417195701010000', '452339900', 16), ('417195801010000', '452139900', 16), ('417199901010000', '452339900', 16), ('417199901020000', '452339900', 16), ('417199901030000', '452339900', 16), ('417199901040000', '452339900', 16),
                        ('417199901050000', '452339900', 16), ('417215001010000', '452140100', 16), ('417215001020000', '452140100', 16), ('417215001030000', '452140100', 16), ('417215101010000', '452140200', 16), ('417215101020000', '452140200', 16),
                        ('417215101030000', '452140200', 16), ('417215201010000', '452140200', 16), ('417215201020000', '452140300', 16), ('417215201030000', '452140300', 16), ('417215301010000', '452140400', 16), ('417219801010000', '452149900', 16),
                        ('417225001010000', '452140500', 16), ('417225101010000', '452140500', 16), ('417225101020000', '452140500', 16), ('417225201010000', '452140500', 16), ('417225201030000', '452140500', 16), ('417225301010000', '452140500', 16),
                        ('417235001010000', '452140600', 16), ('417245001010000', '452349900', 16), ('417245101010000', '452349900', 16), ('417249901010000', '452349900', 16), ('417249901020000', '452349900', 16), ('417295001010000', '452349900', 16),
                        ('417295101010000', '452349900', 16), ('417295201010000', '452349900', 16), ('417295201020000', '452349900', 16), ('417299901010000', '452349900', 16), ('417299901020000', '452349900', 16), ('417299901030000', '452349900', 16),
                        ('417299901040000', '452349900', 16), ('417315001010000', '452359900', 16), ('417325001010000', '452359900', 16), ('417325101010000', '452359900', 16), ('417329901010000', '452359900', 16), ('417329901020000', '452359900', 16),
                        ('417395001010000', '452359900', 16), ('417399901010000', '452359900', 16), ('417399901010100', '452359900', 16), ('417399901020000', '452359900', 16), ('417415001010000', '453110100', 16), ('417415101010000', '453110100', 16),
                        ('417419901010000', '453110100', 16), ('417419901020000', '453110100', 16), ('417515001010000', '452230000', 16), ('417515001020000', '452230000', 16), ('417599901010000', '454119900', 16), ('417599901020000', '454119900', 16),
                        ('417615001010000', '456110000', 16), ('417615101010000', '456110000', 16), ('417619901010000', '456110000', 16), ('417619901020000', '456110000', 16), ('417915001010000', '458110000', 16), ('417915101010000', '458110000', 16),
                        ('417919901010000', '458110000', 16), ('417920101010000', '459119900', 16), ('417999901010000', '459119900', 16), ('419110101010000', '499510000', 16), ('419110101020000', '499510000', 16), ('419110401010000', '499510000', 16),
                        ('419110611010000', '499510000', 16), ('419110621010000', '499510000', 16), ('419110801010000', '499510000', 16), ('419110801020000', '499510000', 16), ('419110801030000', '499510000', 16), ('419110901010000', '499510000', 16),
                        ('419111311010000', '499510000', 16), ('419210101010000', '499610100', 16), ('419210301010000', '499610100', 16), ('419219901010000', '499610100', 16), ('419220111010000', '499610200', 16), ('419220121010000', '499610200', 16),
                        ('419220201010000', '499610200', 16), ('419220301010000', '499610200', 16), ('419220301020000', '499610200', 16), ('419220301030000', '499610200', 16), ('419220401010000', '499610200', 16), ('419220401020000', '499610200', 16),
                        ('419220611010000', '499610200', 16), ('419220621010000', '499610200', 16), ('419220901010000', '499610200', 16), ('419225001010000', '499610200', 16), ('419225001020000', '499610200', 16), ('419225001030000', '499610200', 16),
                        ('419225101010000', '499610200', 16), ('419225101020000', '499610200', 16), ('419229901010000', '499610200', 16), ('419239901010000', '499610300', 16), ('419310211010000', '499910000', 16), ('419310221010000', '499910000', 16),
                        ('419310501010000', '499910000', 16), ('419410101010000', '499510000', 16), ('419410221010000', '499510000', 16), ('419410231010000', '499510000', 16), ('419410301010000', '499510000', 16), ('419419901010000', '499510000', 16),
                        ('419420101010000', '499510000', 16), ('419420301010000', '499510000', 16), ('419429901010000', '499510000', 16), ('419430101010000', '499510000', 16), ('419440301010000', '499510000', 16), ('419440401010000', '499510000', 16),
                        ('419440601010000', '499510000', 16), ('419440711010000', '499510000', 16), ('419499901010000', '499510000', 16), ('419990101010000', '421110300', 16), ('419990101020000', '421110300', 16), ('419990101030000', '421110300', 16),
                        ('419990301010000', '499130000', 16), ('419990301020000', '499130000', 16), ('419990301030000', '499130000', 16), ('419990601010000', '499910000', 16), ('419991101010000', '443919900', 16), ('419991211010000', '442910000', 16),
                        ('419991221010000', '499910000', 16), ('419999921010000', '499910000', 16), ('419999931010000', '499910000', 16), ('421110101010000', '222110101', 16), ('421110201010000', '222130501', 16), ('421110301010000', '222130501', 16),
                        ('421120101010000', '222110298', 16), ('421125001010000', '222140298', 16), ('421125101010000', '222140298', 16), ('421125201010000', '222140298', 16), ('421125301010000', '222140298', 16), ('421125401010000', '222140298', 16),
                        ('421125501010000', '222140298', 16), ('421125601010000', '222140298', 16), ('421199901010000', '222140298', 16), ('421210101010000', '222140298', 16), ('421210201010000', '222210100', 16), ('421220101010000', '222210200', 16),
                        ('421225001010000', '222210200', 16), ('421225101010000', '222210200', 16), ('421225201010000', '222210200', 16), ('421225301010000', '222210200', 16), ('421225401010000', '222210200', 16), ('421225501010000', '222210200', 16),
                        ('421299901010000', '222210200', 16), ('422110101010000', '121310101', 16), ('422110201010000', '121310101', 16), ('422120201020000', '116110000', 16), ('422130101010000', '116210000', 16), ('422210101010000', '462210299', 16),
                        ('422310101010000', '116310000', 16), ('423110401010000', '121110301', 16), ('423110601010000', '121110301', 16), ('423110711010000', '121110302', 16), ('424115011010000', '452339900', 16), ('424115021010000', '452339900', 16),
                        ('424115031010000', '452339900', 16), ('424115041010000', '452339900', 16), ('424115051010000', '452339900', 16), ('424115091010000', '452339900', 16), ('424115111010000', '452339900', 16), ('424115121010000', '452339900', 16),
                        ('424115131010000', '452339900', 16), ('424115141010000', '452339900', 16), ('424115151010000', '452339900', 16), ('424115191010000', '452339900', 16), ('424125011010000', '452339900', 16), ('424125021010000', '452339900', 16),
                        ('424125091010000', '452339900', 16), ('424135001010000', '452339900', 16), ('424145001010000', '452339900', 16), ('424145101010000', '452339900', 16), ('424145201010000', '452339900', 16), ('424145301010000', '452339900', 16),
                        ('424145401010000', '452339900', 16), ('424149901010000', '452339900', 16), ('424149901020000', '452339900', 16), ('424195001010000', '452339900', 16), ('424199901010000', '452339900', 16), ('424215001010000', '452349900', 16),
                        ('424225001010000', '452349900', 16), ('424225101010000', '452349900', 16), ('424225201010000', '452349900', 16), ('424225301010000', '452349900', 16), ('424225401010000', '452349900', 16), ('424229901010000', '452349900', 16),
                        ('424229901020000', '452349900', 16), ('424295001010000', '452349900', 16), ('424295101010000', '452349900', 16), ('424295101020000', '452349900', 16), ('424299901010000', '452349900', 16), ('424299901020000', '452349900', 16),
                        ('424299901030000', '452349900', 16), ('424315001010000', '452359900', 16), ('424325001010000', '452359900', 16), ('424325101010000', '452359900', 16), ('424325201010000', '452359900', 16), ('424329901010000', '452359900', 16),
                        ('424329901020000', '452359900', 16), ('424395001010000', '452359900', 16), ('424399901010000', '452359900', 16), ('424415001010000', '452359900', 16), ('424415101010000', '452359900', 16), ('424419901010000', '453110100', 16),
                        ('424419901020000', '453110100', 16), ('424510101010000', '453110100', 16), ('424615101010000', '456110000', 16), ('424619901010000', '456110000', 16), ('424919901010000', '452410000', 16), ('424920101010000', '452410000', 16),
                        ('424999901010000', '452410000', 16), ('424999901020000', '452410000', 16), ('429110101010000', '231220000', 16), ('429410101010000', '114110100', 16), ('429995001010000', '499910000', 16), ('429999901010000', '499910000', 16),
                        ('429999901020000', '499910000', 16), ('472150211010000', '421120101', 16), ('472150211020000', '421120101', 16), ('472150212010000', '442520102', 16), ('472150212020000', '442520102', 16), ('472150213010000', '112529900', 16),
                        ('472150213020000', '112529900', 16), ('472150214010000', '442520102', 16), ('472150214020000', '442520102', 16), ('472150221010000', '421120102', 16), ('472150221020000', '421120102', 16),('472155011010000', '421120199', 16),
                        ('472155011020000', '421120199', 16), ('472155021010000', '421120199', 16), ('472155021020000', '421120199', 16), ('472155031010000', '421120199', 16), ('472155031020000', '421120199', 16), ('472155041010000', '421120199', 16),
                        ('472155041020000', '421120199', 16), ('472155111010000', '421120102', 16), ('472155111020000', '421120102', 16), ('472155112010000', '442520201', 16), ('472155112020000', '442520201', 16), ('472155113010000', '112529900', 16),
                        ('472155113020000', '112529900', 16), ('472155114010000', '442520201', 16), ('472155114020000', '442520201', 16), ('472155121010000', '421120199', 16), ('472155121020000', '421120199', 16), ('472155131010000', '421120199', 16),
                        ('472155131020000', '421120199', 16), ('476110101010000', '433129900', 16), ('476110101020000', '433129900', 16), ('476110102010000', '442920000', 16), ('476110103010000', '112629900', 16), ('476110104010000', '442920000', 16),
                        ('476999901010000', '433129900', 16), ('479229901010000', '499620000', 16), ('491111250010100', '411219700', 9000), ('491111250010200', '411219700', 9000), ('491111250010300', '411219700', 9000), ('491111451110100', '411319700', 9000),
                        ('491111451110200', '411319700', 9000), ('491111451110300', '411319700', 9000), ('493111250020100', '442410500', 25003), ('493111250020200', '442410500', 25003), ('493111250020300', '442410500', 25003),
                        ('493111250030100', '112510105', 25003), ('493111250030200', '112510105', 25003), ('493111250030300', '112510105', 25003), ('493111250040100', '442411600', 25003), ('493111250040200', '442411600', 25003),
                        ('493111250040300', '442411600', 25003), ('493111451120100', '442410700', 25003), ('493111451120200', '442410700', 25003), ('493111451120300', '442410700', 25003), ('493111451130100', '112510107', 25003),
                        ('493111451130200', '112510107', 25003), ('493111451130300', '112510107', 25003), ('493111451140100', '442411600', 25003), ('493111451140200', '442411600', 25003), ('493111451140300', '442411600', 25003),
                        ('493112101040100', '442411600', 25003), ('493132104010100', '442411600', 25003), ('495111201110100', '352240000', 6), ('495171151110100', '352240000', 6), ('495171152010100', '352240000', 6), ('495172150010100', '352240000', 6),
                        ('495172151010100', '352240000', 6), ('495172152010100', '352240000', 6)";

        $this->execute($insertTempTable);
        $sqlTempTable = "SELECT * FROM pcasp_orcam";
        $resultDados = $this->fetchAll($sqlTempTable);

        foreach ($resultDados as $conta){
            $this->insertVinculo($conta['estrut_orc'], $conta['estrut_pcasp'], $conta['grupo']);
        }

        $this->execute("drop table public.pcasp_orcam");
    }

    private function insertVinculo($estrutOrc, $estrutPcasp, $grupo)
    {
        $sqlIgnoreClient = "select 1 from db_config where cgc = '66489741000196'";
        $ignoreClient = $this->fetchAll($sqlIgnoreClient);
        if (empty($ignoreClient)){

            $sqlTempTable = "SELECT * FROM pg_catalog.pg_tables
                         WHERE tablename = 'anousu'";

            $tempTable = $this->fetchAll($sqlTempTable);

            if (empty($tempTable)) {

                $sqlAno = "CREATE TEMP TABLE anousu ON COMMIT DROP AS
                       SELECT DISTINCT c91_anousudestino FROM conaberturaexe
                       WHERE c91_anousuorigem = 2021";
                $this->execute($sqlAno);
            }

            /*
             * Realizando vinculo das Receitas do Plano Orçamentário com o PCASP
             */

            if ($estrutPcasp != ''){

                $sqlVinculo = " SELECT conplanoconplanoorcamento.* FROM conplanoconplanoorcamento
                            JOIN conplanoorcamento ON (c72_conplanoorcamento, c72_anousu) = (conplanoorcamento.c60_codcon, conplanoorcamento.c60_anousu)
                            JOIN conplano ON (c72_conplano, c72_anousu) = (conplano.c60_codcon, conplano.c60_anousu)
                            JOIN anousu ON c91_anousudestino >= 2022
                            WHERE conplanoorcamento.c60_estrut = '{$estrutOrc}'
                              AND c72_anousu = c91_anousudestino";
                $result = $this->fetchAll($sqlVinculo);

                if (empty($result)){
                    $sqlInsert = "INSERT INTO conplanoconplanoorcamento
                                SELECT nextval('conplanoconplanoorcamento_c72_sequencial_seq'),
                                       conplano.c60_codcon,
                                       conplanoorcamento.c60_codcon,
                                       c91_anousudestino
                                FROM conplanoorcamento
                                JOIN conplano ON conplano.c60_anousu = conplanoorcamento.c60_anousu
                                JOIN anousu ON c91_anousudestino >= 2022
                                WHERE conplanoorcamento.c60_estrut = '{$estrutOrc}'
                                  AND conplanoorcamento.c60_anousu = c91_anousudestino
                                  AND conplanoorcamento.c60_estrut IN (select c60_estrut from conplanoorcamento where c60_anousu = c91_anousudestino)";
                    if ($estrutPcasp == '442411300'){

                        $sqlInsert .= "AND conplano.c60_codcon IN (SELECT c60_codcon FROM conplano WHERE substr(conplano.c60_estrut,1,9) = '{$estrutPcasp}' AND c60_anousu > 2021 ORDER BY c60_estrut LIMIT 1) ";

                    } else{

                        $sqlInsert .= "AND substr(conplano.c60_estrut,1,9) = '{$estrutPcasp}'";
                    }

                    $this->execute($sqlInsert);
                }
            }

            /*
             * Vinculando as Receitas com os Grupos do Plano Orçamentário
             */

            $sqlGrupo = "SELECT conplanoorcamentogrupo.* FROM conplanoorcamentogrupo
                     JOIN conplanoorcamento ON (c21_codcon, c21_anousu) = (c60_codcon, c60_anousu)
                     JOIN anousu ON c91_anousudestino >= 2022
                     WHERE (c60_estrut, c60_anousu) = ('{$estrutOrc}', c91_anousudestino)";
            $resultGrupo = $this->fetchAll($sqlGrupo);

            if (empty($resultGrupo)){
                $sqlInsertGrupo = "INSERT INTO conplanoorcamentogrupo
                                SELECT DISTINCT nextval('conplanoorcamentogrupo_c21_sequencial_seq'),
                                       c91_anousudestino,
                                       c60_codcon,
                                       {$grupo},
                                       db_config.codigo
                                FROM conplanoorcamento
                                JOIN db_config ON 1 = 1
                                JOIN anousu ON c91_anousudestino >= 2022
                                WHERE c60_estrut = '{$estrutOrc}'
                                 AND c60_anousu = c91_anousudestino";
                $this->execute($sqlInsertGrupo);
            }
        }

    }
}
